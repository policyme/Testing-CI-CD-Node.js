language: node_js
node_js: 12.18.1

stages:
  - name: node_job
  - name: python_job
    # only runs this job when it is merged to the approach branch
    if: branch IN (develop, master, gabe-test) AND type = cron
jobs:
  include:
    - stage: node_job
      language: node_js
      node_js: 12.18.1
      install:
        - npm install
      script:
        - npm test
    - stage: python_job
      language: python
      python: 3.6
      install:
        # - pip3 install --extra-index-url http://$PYPI_USER:$PYPI_PASS@$PYPI_IP:$PYPI_PORT --trusted-host $PYPI_IP pm_cicd
        # may not need the install below?
        - pip3 install gitpython
      script:
        - python -c "from pm_cicd.exec import exec_deploy; exec_deploy()"

deploy:
  - provider: elasticbeanstalk
    access_key_id: $AWS_ACCESS_KEY_ID
    secret_access_key: $AWS_SECRET_ACCESS_KEY
    region: us-east-2
    app: Testing-CICD-Node
    env: TestingCicdNode-env
    bucket_name: elasticbeanstalk-us-east-2-405734297549
    bucket_path: Testing-CICD
    on:
      branch: gabe-test
      